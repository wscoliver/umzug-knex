{"version":3,"sources":["../../../src/spec/migrations/001_tag.js"],"names":["describe","migrationDir","join","__dirname","umzug","knex","before","done","connect","storage","migrations","params","path","pattern","pending","then","execute","method","migrated","catch","err","console","warn","it","schema","hasTable","exists","to","equal","columnInfo","info","id","not","type","nullable","name","result","Promise","resolve","reject","res"],"mappings":";;8QAAA;;;;;AAKA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEAA,SAAS,uBAAT,EAAkC,YAAY;AAC5C,MAAIC,eAAe,eAAKC,IAAL,CAAUC,SAAV,EAAoB,mBAApB,CAAnB;AACA,MAAIC,QAAQ,EAAZ;AACA,MAAIC,OAAO,EAAX;AACAC,SAAO,UAAUC,IAAV,EAAgB;AACrBF,WAAO,aAAGG,OAAH,EAAP;AACAJ,YAAQ,oBAAU;AAChBK,eAAS,MADO;AAEhBC,kBAAY;AACVC,gBAAQ,CAAEN,IAAF,CADE;AAEVO,cAAMX,YAFI;AAGVY,iBAAS;AAHC;AAFI,KAAV,CAAR;AAQAT,UAAMU,OAAN,GAAgBC,IAAhB,CAAqB,UAAUL,UAAV,EAAsB;AACzCN,YAAMY,OAAN,CAAc;AACZC,gBAAQ,IADI;AAEZP,oBAAY,CACV,SADU;AAFA,OAAd,EAKGK,IALH,CAKQ,UAASG,QAAT,EAAmB;AACzBX;AACD,OAPD,EAOGY,KAPH,CAOS,UAASC,GAAT,EAAc;AACrBC,gBAAQC,IAAR,CAAaF,GAAb;AACD,OATD;AAUD,KAXD;AAYD,GAtBD;AAuBAG,KAAG,+BAAH,EAAoC,UAAShB,IAAT,EAAe;AACjDF,SAAKmB,MAAL,CAAYC,QAAZ,CAAqB,MAArB,EAA6BV,IAA7B,CAAkC,UAASW,MAAT,EAAiB;AACjD,wBAAOA,MAAP,EAAeC,EAAf,CAAkBC,KAAlB,CAAwB,IAAxB;AACArB;AACD,KAHD;AAID,GALD;AAMAgB,KAAG,2CAAH,EAAgD,UAAShB,IAAT,EAAe;AAC7DF,SAAK,MAAL,EAAawB,UAAb,GAA0Bd,IAA1B,CAA+B,UAASe,IAAT,EAAe;AAC5C,gCAAcA,KAAKC,EAAnB,GAAwBJ,EAAxB,CAA2BK,GAA3B,CAA+BJ,KAA/B,CAAqC,WAArC;AACA,wBAAOE,KAAKC,EAAL,CAAQE,IAAf,EAAqBN,EAArB,CAAwBC,KAAxB,CAA8B,KAA9B;AACA,wBAAOE,KAAKC,EAAL,CAAQG,QAAf,EAAyBP,EAAzB,CAA4BC,KAA5B,CAAkC,KAAlC;AACA,gCAAcE,KAAKK,IAAnB,GAA0BR,EAA1B,CAA6BK,GAA7B,CAAiCJ,KAAjC,CAAuC,WAAvC;AACA,wBAAOE,KAAKK,IAAL,CAAUF,IAAjB,EAAuBN,EAAvB,CAA0BC,KAA1B,CAAgC,SAAhC;AACA,wBAAOE,KAAKK,IAAL,CAAUD,QAAjB,EAA2BP,EAA3B,CAA8BC,KAA9B,CAAoC,KAApC;AACArB;AACD,KARD;AASD,GAVD;AAWAgB,KAAG,4BAAH,EAAiC,UAAShB,IAAT,EAAe;AAC9CH,UAAMY,OAAN,CAAc;AACZC,cAAQ,MADI;AAEZP,kBAAY,CACV,SADU;AAFA,KAAd,EAKGK,IALH,CAKQ,UAACqB,MAAD,EAAY;AAClB,aAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtClC,aAAKmB,MAAL,CAAYC,QAAZ,CAAqB,MAArB,EAA6BV,IAA7B,CAAkCuB,OAAlC,EAA2CnB,KAA3C,CAAiDoB,MAAjD;AACD,OAFM,CAAP;AAGD,KATD,EASGxB,IATH,CASQ,UAACyB,GAAD,EAAS;AACf,wBAAOA,GAAP,EAAYb,EAAZ,CAAeC,KAAf,CAAqB,KAArB;AACArB;AACD,KAZD;AAaD,GAdD;AAeD,CA3DD","file":"001_tag.js","sourcesContent":["/*\n  @name 001_tag.js\n  @description Migration test for tag.\n*/\n\nimport { expect } from 'chai'\nimport Umzug from 'umzug'\nimport db from '../../db'\nimport fs from 'fs'\nimport path from 'path'\n\ndescribe('Migration: 001_tag.js', function () {\n  let migrationDir = path.join(__dirname,'/../../migrations')\n  let umzug = {}\n  let knex = {}\n  before(function (done) {\n    knex = db.connect()\n    umzug = new Umzug({\n      storage: 'json',\n      migrations: {\n        params: [ knex ],\n        path: migrationDir,\n        pattern: /[^=&#]+.js$/\n      }\n    })\n    umzug.pending().then(function (migrations) {\n      umzug.execute({\n        method: 'up',\n        migrations: [\n          '001_tag'\n        ]\n      }).then(function(migrated) {\n        done()\n      }).catch(function(err) {\n        console.warn(err)\n      })\n    })\n  })\n  it('should migrate the tags table', function(done) {\n    knex.schema.hasTable('tags').then(function(exists) {\n      expect(exists).to.equal(true)\n      done()\n    })\n  })\n  it('should have an ID field and a name field.', function(done) {\n    knex('tags').columnInfo().then(function(info) {\n      expect(typeof(info.id)).to.not.equal('undefined')\n      expect(info.id.type).to.equal('int') \n      expect(info.id.nullable).to.equal(false) \n      expect(typeof(info.name)).to.not.equal('undefined')\n      expect(info.name.type).to.equal('varchar') \n      expect(info.name.nullable).to.equal(false) \n      done()\n    })\n  })\n  it('should drop the tags table', function(done) {\n    umzug.execute({\n      method: 'down',\n      migrations: [\n        '001_tag'\n      ]\n    }).then((result) => {\n      return new Promise((resolve, reject) => {\n        knex.schema.hasTable('tags').then(resolve).catch(reject)\n      })\n    }).then((res) => {\n      expect(res).to.equal(false)\n      done()\n    })\n  })\n})\n"]}